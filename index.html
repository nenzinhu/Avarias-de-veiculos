<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PMRV - Relatório de Avarias</title>

<style>
:root{
--vermelho:#b71c1c;
--cinza:#f2f2f2;
--verde:#2e7d32;
}

body{
margin:0;
font-family:Segoe UI, Arial;
background:var(--cinza);
}

/* ================= HEADER ================= */

.header{
background:var(--vermelho);
color:white;
padding:14px;
text-align:center;
font-weight:600;
font-size:16px;
}

/* ================= ABAS ================= */

.abas{
display:flex;
gap:6px;
padding:10px;
background:white;
}

.abas button{
flex:1;
padding:8px;
border:none;
border-radius:20px;
background:#ddd;
font-weight:600;
cursor:pointer;
font-size:13px;
}

.abas button.ativo{
background:var(--vermelho);
color:white;
}

/* ================= LAYOUT ================= */

.layout{
display:flex;
flex-wrap:wrap;
gap:15px;
justify-content:center;
max-width:1200px;
margin:auto;
}

/* ================= IMAGEM ================= */

.container{
position:relative;
background:white;
border-radius:12px;
overflow:hidden;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
max-width:900px;
width:95%;
}

.container img{
width:100%;
display:block;
}

.numero-wrapper{
position:absolute;
transform:translate(-50%, -50%);
}

.numero-marker{
width:32px;
height:32px;
background:var(--vermelho);
color:white;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
font-size:14px;
font-weight:bold;
cursor:pointer;
transition:0.2s;
}

.numero-marker.vistoriado{
background:var(--verde);
}

/* ================= LEGENDA 2 COLUNAS ================= */

.legenda{
background:white;
padding:15px;
border-radius:12px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
max-width:400px;
width:95%;
font-size:14px;
}

.legenda h4{
margin-top:0;
margin-bottom:10px;
}

.legenda-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:5px 20px;
}

.legenda-grid ul{
list-style:none;
padding:0;
margin:0;
}

.legenda-grid li{
margin-bottom:6px;
font-size:13px;
}

.legenda-grid li.ativo{
color:var(--verde);
font-weight:bold;
}

/* ================= RELATÓRIO ================= */

.relatorio{
margin:15px auto;
background:white;
padding:15px;
border-radius:12px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
max-width:900px;
width:95%;
}

.relatorio button{
width:100%;
margin-top:8px;
padding:10px;
border:none;
border-radius:8px;
font-weight:bold;
cursor:pointer;
color:white;
font-size:14px;
}

.btn-copy{background:var(--verde);}
.btn-clear{background:#777;}
.btn-whats{background:#25D366;}

/* ================= MODAL ================= */

.modal{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.6);
display:none;
align-items:center;
justify-content:center;
z-index:999;
}

.modal-box{
background:white;
padding:20px;
border-radius:12px;
width:260px;
text-align:center;
}

.modal-box button{
width:100%;
margin:6px 0;
padding:10px;
border:none;
border-radius:8px;
background:var(--vermelho);
color:white;
font-weight:bold;
cursor:pointer;
}

.modal-box .cancelar{
background:#777;
}
</style>
</head>

<body>

<div class="header">PMRV - Relatório de Avarias</div>

<div class="abas">
<button onclick="mudarVista('frente')" id="btn-frente" class="ativo">Frente</button>
<button onclick="mudarVista('tras')" id="btn-tras">Traseira</button>
<button onclick="mudarVista('direita')" id="btn-direita">Direita</button>
<button onclick="mudarVista('esquerda')" id="btn-esquerda">Esquerda</button>
</div>

<div class="layout">

<div class="container">
<img id="imagemCarro" src="frente.png">
<div id="camadaInterativa"></div>
</div>

<div class="legenda">
<h4>Legenda da Vista</h4>
<div class="legenda-grid">
<ul id="coluna1"></ul>
<ul id="coluna2"></ul>
</div>
</div>

</div>

<div class="relatorio">
<h3>Relatório de Avarias</h3>

<p id="introducaoRelatorio" style="display:none; font-weight:500;">
Foram observadas as seguintes avarias externas no veículo:
</p>

<ul id="listaAvarias"></ul>

<button class="btn-copy" onclick="copiarRelatorio()">Copiar Relatório</button>
<button class="btn-whats" onclick="enviarWhatsApp()">Compartilhar via WhatsApp</button>
<button class="btn-clear" onclick="limparRelatorio()">Limpar Relatório</button>
</div>

<div id="modalAvaria" class="modal">
  <div class="modal-box">
    <h4>Tipo de Avaria</h4>
    <button onclick="selecionarAvaria('Amassado')">Amassado</button>
    <button onclick="selecionarAvaria('Arranhão')">Arranhão</button>
    <button onclick="selecionarAvaria('Quebrado')">Quebrado</button>
    <button onclick="selecionarAvaria('Trincado')">Trincado</button>
    <button class="cancelar" onclick="fecharModal()">Cancelar</button>
  </div>
</div>

<script>

let vistaAtual='frente';
let relatorio=[];
let pecaSelecionada=null;

const mapa = {

  frente: [
    { n: "Capô", t: 207, l: 362 },
    { n: "Para-choque", t: 256, l: 446 },
    { n: "Para-Brisa", t: 124, l: 494 },
    { n: "Farol Direito", t: 272, l: 258 },
    { n: "Farol Esquerdo", t: 267, l: 653 },
    { n: "Farol de Milha Direito", t: 378, l: 269 },
    { n: "Farol de Milha Esquerdo", t: 377, l: 669 },
    { n: "Grade Superior Frontal", t: 299, l: 557 },
    { n: "Grade Inferior Frontal", t: 398, l: 548 },
    { n: "Retrovisor Direito", t: 170, l: 206 },
    { n: "Retrovisor Esquerdo", t: 170, l: 696 },
    { n: "Para-lama Dianteiro Esquerdo", t: 329, l: 184 },
    { n: "Para-lama Dianteiro Direito", t: 309, l: 712 },
    { n: "Placa Dianteira", t: 378, l: 444 }
  ],

  tras: [
    { n: "Lanterna Traseira Esquerda", t: 273, l: 256 },
    { n: "Lanterna Traseira Direita", t: 272, l: 623 },
    { n: "Vidro Traseiro - Vigia", t: 191, l: 375 },
    { n: "Tampa Porta-Malas", t: 327, l: 361 },
    { n: "Para-choque Traseiro", t: 359, l: 491 },
    { n: "Escapamento", t: 443, l: 314 },
    { n: "Refletor Esquerdo", t: 397, l: 277 },
    { n: "Refletor Direito", t: 406, l: 605 },
    { n: "Emblema", t: 236, l: 440 },
    { n: "Placa Traseira", t: 286, l: 441 }
  ],

  direita: [
    { n: "Roda Dianteira Direita", t: 362, l: 175 },
    { n: "Roda Traseira Direita", t: 364, l: 649 },
    { n: "Porta Dianteira Direita", t: 313, l: 485 },
    { n: "Porta Traseira Direita", t: 329, l: 310 },
    { n: "Vidro Dianteiro Direito", t: 214, l: 432 },
    { n: "Vidro Traseiro Direito", t: 199, l: 296 },
    { n: "Para-lama Dianteiro Direito", t: 340, l: 734 }
  ],

  esquerda: [
    { n: "Roda Dianteira Esquerda", t: 397, l: 193 },
    { n: "Roda Traseira Esquerda", t: 393, l: 687 },
    { n: "Porta Dianteira Esquerda", t: 333, l: 382 },
    { n: "Porta Traseira Esquerda", t: 334, l: 549 },
    { n: "Vidro Dianteiro Esquerdo", t: 227, l: 410 },
    { n: "Vidro Traseiro Esquerdo", t: 214, l: 552 },
    { n: "Para-lama Dianteiro Esquerdo", t: 382, l: 113 }
  ]

};




function mudarVista(v){
vistaAtual=v;
document.getElementById("imagemCarro").src=v+".png";
document.querySelectorAll(".abas button").forEach(b=>b.classList.remove("ativo"));
document.getElementById("btn-"+v).classList.add("ativo");
gerarNumeros();
}

function gerarNumeros(){

const camada=document.getElementById("camadaInterativa");
const coluna1=document.getElementById("coluna1");
const coluna2=document.getElementById("coluna2");

camada.innerHTML="";
coluna1.innerHTML="";
coluna2.innerHTML="";

if(!mapa[vistaAtual]) return;

mapa[vistaAtual].forEach((p,i)=>{

const wrapper=document.createElement("div");
wrapper.className="numero-wrapper";
wrapper.style.top=(p.t/500*100)+"%";
wrapper.style.left=(p.l/900*100)+"%";

const marker=document.createElement("div");
marker.className="numero-marker";
marker.innerText=i+1;

wrapper.appendChild(marker);
camada.appendChild(wrapper);

let li=document.createElement("li");
li.id="leg-"+i;
li.innerText=(i+1)+" - "+p.n;

if(i<7){
coluna1.appendChild(li);
}else{
coluna2.appendChild(li);
}

marker.onclick=()=>{
pecaSelecionada={
nome:p.n,
elemento:marker,
indice:i
};
document.getElementById("modalAvaria").style.display="flex";
};

});
}

function selecionarAvaria(tipo){

pecaSelecionada.elemento.classList.add("vistoriado");
pecaSelecionada.elemento.innerText="✔";

relatorio.push(pecaSelecionada.nome+" - "+tipo);

let item=document.getElementById("leg-"+pecaSelecionada.indice);
if(item){
item.classList.add("ativo");
item.innerText="✔ "+item.innerText;
}

atualizarRelatorio();
fecharModal();
}

function fecharModal(){
document.getElementById("modalAvaria").style.display="none";
}

function atualizarRelatorio(){
const lista=document.getElementById("listaAvarias");
const intro=document.getElementById("introducaoRelatorio");

lista.innerHTML="";

if(relatorio.length===0){
intro.style.display="none";
return;
}

intro.style.display="block";

relatorio.forEach(r=>{
let li=document.createElement("li");
li.textContent=r;
lista.appendChild(li);
});
}

function copiarRelatorio(){
if(relatorio.length===0) return alert("Nenhuma avaria registrada.");
let texto="PMRV - RELATÓRIO DE AVARIAS\n\n";
texto+="Foram observadas as seguintes avarias externas no veículo:\n\n";
relatorio.forEach(r=>texto+="- "+r+"\n");
navigator.clipboard.writeText(texto);
alert("Relatório copiado!");
}

function enviarWhatsApp(){
if(relatorio.length===0) return alert("Nenhuma avaria registrada.");
let texto="PMRV - RELATÓRIO DE AVARIAS\n\n";
texto+="Foram observadas as seguintes avarias externas no veículo:\n\n";
relatorio.forEach(r=>texto+="- "+r+"\n");
window.open("https://api.whatsapp.com/send?text="+encodeURIComponent(texto));
}

function limparRelatorio(){
relatorio=[];
document.querySelectorAll(".numero-marker").forEach(m=>{
m.classList.remove("vistoriado");
});
gerarNumeros();
atualizarRelatorio();
}

window.onload=()=>mudarVista('frente');

</script>
</body>
</html>
