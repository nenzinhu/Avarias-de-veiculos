<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PMRV - Vistoria Veicular</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; text-align: center; overflow-x: hidden; }
        .header-pmrv { background: #d63031; color: white; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .header-pmrv h2 { margin: 0; font-size: 18px; text-transform: uppercase; }
        .top-buttons { background: #fff; padding: 10px; display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; border-bottom: 2px solid #ddd; position: relative; z-index: 1000; }
        .top-buttons button { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; background: #2d3436; color: #fff; font-size: 12px; flex: 1 1 40%; }
        .container { position: relative; display: inline-block; width: 95%; max-width: 900px; margin: 10px auto; background: #fff; border-radius: 8px; line-height: 0; }
        .container img { width: 100%; height: auto; display: block; }
        .area-interativa { position: absolute; cursor: pointer; background: rgba(255, 255, 255, 0.01); z-index: 50; touch-action: manipulation; }
        .peca-concluida { border: 2px solid #27ae60 !important; background: rgba(39, 174, 96, 0.3) !important; }
        .relatorio-box { margin: 20px auto; background: white; padding: 20px; border-radius: 10px; width: 90%; text-align: left; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 8px solid #d63031; }
        .btn-acao { padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; margin-top: 10px; width: 100%; }
        .btn-whatsapp { background: #25D366; }
        .btn-copy { background: #27ae60; }
        .btn-clear { background: #7f8c8d; }
        #modalDano { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 12px; box-shadow: 0 0 30px rgba(0,0,0,0.5); z-index: 200; width: 85%; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 150; }
        .opt-dano { display: block; width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; text-align: center; background: #f9f9f9; }
    </style>
</head>
<body>

<div class="header-pmrv">
    <h2>PMRV: Registro de Avarias</h2>
</div>

<div class="top-buttons">
    <button type="button" onpointerdown="mudarVista('frente')">Frontal</button>
    <button type="button" onpointerdown="mudarVista('tras')">Traseira</button>
    <button type="button" onpointerdown="mudarVista('esquerda')">Lat. Esquerda</button>
    <button type="button" onpointerdown="mudarVista('direita')">Lat. Direita</button>
</div>

<div class="container" id="areaImagem">
    <img id="imagemCarro" src="frente.png">
    <div id="camadaInterativa"></div>
</div>

<div class="relatorio-box">
    <div style="font-weight: bold; color: #d63031; margin-bottom: 10px;">Avarias identificadas:</div>
    <ul id="listaRelatorio" style="padding-left: 20px;"></ul>
    <button class="btn-acao btn-whatsapp" onclick="enviarWhatsApp()">Enviar via WhatsApp</button>
    <button class="btn-acao btn-copy" onclick="copiarRelatorio()">Copiar Relatório</button>
    <button class="btn-acao btn-clear" onclick="limparRelatorio()">Limpar Tudo</button>
</div>

<div class="overlay" id="overlay" onclick="fecharModal()"></div>
<div id="modalDano">
    <h3 id="nomePeca" style="color:#d63031; margin-top: 0;">Selecione o Dano</h3>
    <button class="opt-dano" onclick="addDano('Amassado')">Amassado</button>
    <button class="opt-dano" onclick="addDano('Trincado')">Trincado</button>
    <button class="opt-dano" onclick="addDano('Riscado')">Riscado</button>
    <button class="opt-dano" onclick="addDano('Quebrado')">Quebrado</button>
</div>

<script>
    let vistaAtual = 'frente';
    let pecaAlvo = "";
    let divAlvo = null;
    let dadosRelatorio = [];
    let pecasConcluidas = {};
    const BASE_W = 900;
    const BASE_H = 500;

    const mapa = {
        'frente': [
            {n: "Capô", t: 172, l: 253, w: 403, h: 62},
            {n: "Para-choque", t: 304, l: 205, w: 482, h: 31},
            {n: "Para-Brisa", t: 93, l: 293, w: 313, h: 78},
            {n: "Farol Dir", t: 243, l: 213, w: 100, h: 38},
            {n: "Farol Esq", t: 240, l: 599, w: 89, h: 44}
        ],
        'tras': [
            {n: "Lanterna Esq", t: 271, l: 238, w: 106, h: 34},
            {n: "Lanterna Dir", t: 271, l: 532, w: 116, h: 36},
            {n: "Tampa Porta-Malas", t: 318, l: 319, w: 246, h: 48},
            {n: "Para-Choque Tras", t: 367, l: 248, w: 388, h: 49}
        ],
        'direita': [
            {n: "Porta Dianteira Dir", t: 234, l: 376, w: 178, h: 113},
            {n: "Porta Traseira Dir", t: 224, l: 260, w: 113, h: 106}
        ],
        'esquerda': [
            {n: "Porta Dianteira Esq", t: 229, l: 295, w: 178, h: 113},
            {n: "Porta Traseira Esq", t: 219, l: 485, w: 113, h: 106}
        ]
    };

    function mudarVista(vista) {
        vistaAtual = vista;
        document.getElementById("imagemCarro").src = vista + ".png";
        
        document.querySelectorAll('.top-buttons button').forEach(btn => {
            btn.style.background = "#2d3436";
            if (btn.innerText.toLowerCase().includes(vista.substring(0, 3))) {
                btn.style.background = "#d63031";
            }
        });

        const camada = document.getElementById("camadaInterativa");
        camada.innerHTML = "";
        
        if (mapa[vista]) {
            mapa[vista].forEach((p) => {
                const div = document.createElement("div");
                const chave = `${vistaAtual}-${p.n}`;
                div.className = "area-interativa" + (pecasConcluidas[chave] ? " peca-concluida" : "");
                div.style.top = (p.t / BASE_H * 100) + "%";
                div.style.left = (p.l / BASE_W * 100) + "%";
                div.style.width = (p.w / BASE_W * 100) + "%";
                div.style.height = (p.h / BASE_H * 100) + "%";

                div.onpointerdown = (e) => {
                    e.preventDefault();
                    pecaAlvo = p.n;
                    divAlvo = div;
                    abrirModal(p.n);
                };
                camada.appendChild(div);
            });
        }
    }

    function abrirModal(nome) {
        document.getElementById("nomePeca").innerText = "Dano em: " + nome;
        document.getElementById("modalDano").style.display = "block";
        document.getElementById("overlay").style.display = "block";
    }

    function fecharModal() {
        document.getElementById("modalDano").style.display = "none";
        document.getElementById("overlay").style.display = "none";
    }

    function addDano(tipo) {
        dadosRelatorio.push(`- ${pecaAlvo}: ${tipo}`);
        pecasConcluidas[`${vistaAtual}-${pecaAlvo}`] = true;
        if (divAlvo) divAlvo.classList.add("peca-concluida");
        atualizarRelatorio();
        fecharModal();
    }

    function atualizarRelatorio() {
        const lista = document.getElementById("listaRelatorio");
        lista.innerHTML = "";
        dadosRelatorio.forEach(d => {
            const li = document.createElement("li");
            li.innerText = d;
            lista.appendChild(li);
        });
    }

    function copiarRelatorio() {
        if(dadosRelatorio.length === 0) return alert("Nenhum dano registrado.");
        const texto = "PMRV - AVARIAS APARENTES:\n" + dadosRelatorio.join("\n");
        const tempInput = document.createElement("textarea");
        tempInput.value = texto;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
        alert("Copiado!");
    }

    function enviarWhatsApp() {
        if(dadosRelatorio.length === 0) return alert("Nenhum dano registrado.");
        const msg = encodeURIComponent("*PMRV - AVARIAS*\n" + dadosRelatorio.join("\n"));
        window.open(`https://api.whatsapp.com/send?text=${msg}`, '_blank');
    }

    function limparRelatorio() {
        if(confirm("Apagar tudo?")) {
            dadosRelatorio = [];
            pecasConcluidas = {};
            atualizarRelatorio();
            mudarVista(vistaAtual);
        }
    }

    window.onload = () => mudarVista('frente');
</script>
</body>
</html>
