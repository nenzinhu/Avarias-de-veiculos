<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMRV - Vistoria Veicular</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        /* FAIXA VERMELHA COM O TÍTULO */
        .header-pmrv {
            background: #d63031;
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }

        .header-pmrv h2 {
            margin: 0;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .top-buttons { 
            background: #fff;
            padding: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }

        .top-buttons button {
            padding: 12px 18px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            background: #2d3436;
            color: #fff;
            transition: 0.3s;
        }

        .top-buttons button:hover { background: #d63031; }
        .btn-active { background: #d63031 !important; border: 2px solid #fff !important; }

        .container {
            position: relative;
            display: inline-block;
            border: 5px solid #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-radius: 10px;
            background: #eee;
            overflow: visible;
        }

        .container img {
            width: 900px;
            max-width: 100%;
            display: block;
        }

        .area-interativa {
            position: absolute;
            cursor: pointer;
            background: rgba(255, 255, 255, 0);
            border: 2px solid transparent;
            z-index: 10;
            transition: 0.2s;
        }

        .area-interativa:hover {
            background: rgba(214, 48, 49, 0.2);
            border: 2px dashed #d63031;
        }

        .peca-concluida {
            border: 2px solid #27ae60 !important;
            background: rgba(39, 174, 96, 0.2) !important;
        }

        .area-interativa::after {
            content: attr(data-name);
            position: absolute;
            bottom: 105%;
            left: 50%;
            transform: translateX(-50%);
            background: #2d3436;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            display: none;
            z-index: 20;
            white-space: nowrap;
        }

        .area-interativa:hover::after { display: block; }

        .relatorio-box {
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            text-align: left;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 8px solid #d63031;
        }

        .controles-relatorio {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .btn-acao {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
        }

        .btn-copy { background: #27ae60; }
        .btn-clear { background: #7f8c8d; }

        #modalDano {
            display: none;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 99;
        }

        .opt-dano {
            display: block; width: 100%; padding: 12px; margin: 8px 0;
            border: 1px solid #ddd; border-radius: 6px; cursor: pointer;
            font-weight: bold;
        }
        .opt-dano:hover { background: #f8f8f8; color: #d63031; }
    </style>
</head>
<body>

<div class="header-pmrv">
    <h2>PMRV: Registro de Avarias e Danos Externos Aparentes</h2>
</div>

<div class="top-buttons">
    <button id="btn-frente" onclick="mudarVista('frente')">Frontal</button>
    <button id="btn-tras" onclick="mudarVista('tras')">Traseira</button>
    <button id="btn-esquerda" onclick="mudarVista('esquerda')">Lateral Esquerda</button>
    <button id="btn-direita" onclick="mudarVista('direita')">Lateral Direita</button>
</div>

<div class="container" id="areaImagem">
    <img id="imagemCarro" src="frente.png">
    <div id="camadaInterativa"></div>
</div>

<div class="relatorio-box">
    <div style="font-weight: bold; color: #d63031; margin-bottom: 10px;">
        Foram identificadas as seguintes avarias na estrutura externa do veiculo:
    </div>
    <ul id="listaRelatorio" style="list-style-type: disc; padding-left: 25px;"></ul>
    
    <div class="controles-relatorio">
        <button class="btn-acao btn-copy" onclick="copiarRelatorio()">Copiar Relatório</button>
        <button class="btn-acao btn-clear" onclick="limparRelatorio()">Limpar</button>
    </div>
</div>

<div class="overlay" id="overlay" onclick="fecharModal()"></div>
<div id="modalDano">
    <h3 id="nomePeca" style="color:#d63031; margin-top: 0;">Selecione o Dano</h3>
    <button class="opt-dano" onclick="addDano('Amassado')">Amassado</button>
    <button class="opt-dano" onclick="addDano('Trincado')">Trincado</button>
    <button class="opt-dano" onclick="addDano('Riscado')">Riscado</button>
    <button class="opt-dano" onclick="addDano('Quebrado')">Quebrado</button>
</div>

<script>
    let vistaAtual = 'frente';
    let pecaAlvo = "";
    let divAlvo = null;
    let dadosRelatorio = [];
    let pecasConcluidas = {}; 

    const mapa = {
        'frente': [
            {n: "Capô", t: 172, l: 253, w: 403, h: 62},
            {n: "Para-choque", t: 304, l: 205, w: 482, h: 31},
            {n: "Para-Brisa", t: 93, l: 293, w: 313, h: 78},
            {n: "Farol Direito", t: 243, l: 213, w: 100, h: 38},
            {n: "Farol Esquerdo", t: 240, l: 599, w: 89, h: 44},
            {n: "Farol de Milha Dir", t: 342, l: 213, w: 78, h: 36},
            {n: "Farol de Milha Esq", t: 344, l: 602, w: 97, h: 37},
            {n: "Grade Superior Frontal", t: 265, l: 334, w: 236, h: 35},
            {n: "Grade Inferior Frontal", t: 368, l: 303, w: 288, h: 34},
            {n: "Retrovisor Dir", t: 138, l: 162, w: 79, h: 52},
            {n: "Retrovisor Esq", t: 139, l: 657, w: 87, h: 50}
        ],
        'tras': [
            {n: "Lanterna Traseira Esq", t: 271, l: 238, w: 106, h: 34},
            {n: "Lanterna Traseira Dir", t: 271, l: 532, w: 116, h: 36},
            {n: "Vidro Traseiro - Vigia", t: 172, l: 304, w: 270, h: 63},
            {n: "Tampa Porta-Malas", t: 318, l: 319, w: 246, h: 48},
            {n: "Para-Choque Traseiro", t: 367, l: 248, w: 388, h: 49},
            {n: "Escapamento", t: 446, l: 250, w: 111, h: 42},
            {n: "Refletor Esq", t: 415, l: 257, w: 96, h: 15},
            {n: "Refletor Dir", t: 419, l: 551, w: 86, h: 27},
            {n: "Emblema", t: 244, l: 411, w: 49, h: 30},
            {n: "Placa Traseira", t: 274, l: 368, w: 148, h: 42}
        ],
        'direita': [
            {n: "Roda Dianteira Direita", t: 281, l: 138, w: 71, h: 80},
            {n: "Roda Traseira Direita", t: 296, l: 596, w: 111, h: 76},
            {n: "Porta Dianteira Direita", t: 234, l: 376, w: 178, h: 113},
            {n: "Porta Traseira Direita", t: 224, l: 260, w: 113, h: 106},
            {n: "Vidro Dianteiro Direita", t: 167, l: 369, w: 104, h: 58},
            {n: "Vidro Traseiro Direita", t: 170, l: 207, w: 148, h: 39},
            {n: "Para-Lama Dianteiro Direita", t: 275, l: 723, w: 41, h: 100}
        ],
        'esquerda': [
            {n: "Roda Dianteira Esq", t: 283, l: 154, w: 111, h: 87},
            {n: "Roda Traseira Esq", t: 286, l: 636, w: 111, h: 76},
            {n: "Porta Dianteira Esq", t: 229, l: 295, w: 178, h: 113},
            {n: "Porta Traseira Esq", t: 219, l: 485, w: 113, h: 106},
            {n: "Vidro Dianteiro Esq", t: 162, l: 373, w: 104, h: 58},
            {n: "Vidro Traseiro Esq", t: 156, l: 502, w: 152, h: 60},
            {n: "Para-Lama Dianteiro Esq", t: 259, l: 97, w: 41, h: 100}
        ]
    };

    function mudarVista(vista) {
        vistaAtual = vista;
        document.getElementById("imagemCarro").src = vista + ".png";
        
        document.querySelectorAll('.top-buttons button').forEach(b => b.classList.remove('btn-active'));
        document.getElementById('btn-' + vista).classList.add('btn-active');

        const camada = document.getElementById("camadaInterativa");
        camada.innerHTML = "";
        
        mapa[vista].forEach((p) => {
            const div = document.createElement("div");
            const chave = `${vistaAtual}-${p.n}`;
            const jaConcluido = pecasConcluidas[chave];

            div.className = "area-interativa" + (jaConcluido ? " peca-concluida" : "");
            div.setAttribute("data-name", jaConcluido ? p.n + " ✅" : p.n);
            div.style.top = p.t + "px";
            div.style.left = p.l + "px";
            div.style.width = p.w + "px";
            div.style.height = p.h + "px";
            
            div.onclick = () => { pecaAlvo = p.n; divAlvo = div; abrirModal(p.n); };
            camada.appendChild(div);
        });
    }

    function abrirModal(nome) {
        document.getElementById("nomePeca").innerText = nome;
        document.getElementById("modalDano").style.display = "block";
        document.getElementById("overlay").style.display = "block";
    }

    function fecharModal() {
        document.getElementById("modalDano").style.display = "none";
        document.getElementById("overlay").style.display = "none";
    }

    function addDano(tipo) {
        dadosRelatorio.push(`- ${pecaAlvo}: ${tipo}`);
        pecasConcluidas[`${vistaAtual}-${pecaAlvo}`] = true;
        
        if (divAlvo) {
            divAlvo.classList.add("peca-concluida");
            divAlvo.setAttribute("data-name", pecaAlvo + " ✅");
        }

        const lista = document.getElementById("listaRelatorio");
        lista.innerHTML = "";
        dadosRelatorio.forEach(d => {
            const li = document.createElement("li"); li.innerText = d; lista.appendChild(li);
        });
        fecharModal();
    }

    function limparRelatorio() {
        if(confirm("Deseja apagar todos os registros desta vistoria?")) {
            dadosRelatorio = [];
            pecasConcluidas = {};
            document.getElementById("listaRelatorio").innerHTML = "";
            mudarVista(vistaAtual);
        }
    }

    function copiarRelatorio() {
        if(dadosRelatorio.length === 0) return alert("Nenhum dano foi registrado.");
        const titulo = "PMRV: Registro de Avarias e Danos Externos Aparentes\n";
        const intro = "Foram identificadas as seguintes avarias na estrutura externa do veiculo:\n";
        navigator.clipboard.writeText(titulo + intro + dadosRelatorio.join("\n"));
        alert("Relatório copiado para a área de transferência!");
    }

    window.onload = () => mudarVista('frente');
</script>
</body>
</html>